openapi: 3.0.0
info:
  title: Backend Boilerplate API
  description: API de gerenciamento de usuários com Autenticação JWT e RBAC.
  version: 1.0.0
servers:
  - url: http://localhost:3000
    description: Servidor Local

# Definição do esquema de segurança (Token JWT)
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

# Segurança global (pode ser sobrescrita em cada rota)
security:
  - bearerAuth: []

paths:
  # ==========================
  # AUTENTICAÇÃO (AUTH)
  # ==========================
  /api/auth/login:
    post:
      summary: Realizar Login (Obter Token)
      tags: [Auth]
      security: [] # Rota pública
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: admin@loja.com
                password:
                  type: string
                  example: 123456
      responses:
        200:
          description: Login realizado com sucesso
        401:
          description: Credenciais inválidas
        429:
          description: Muitas tentativas (Bloqueio temporário)

  /api/auth/forgot-password:
    post:
      summary: Solicitar recuperação de senha
      tags: [Auth]
      security: [] # Rota pública
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  example: admin@loja.com
      responses:
        200:
          description: Token enviado (simulado no console)

  /api/auth/reset-password/{token}:
    post:
      summary: Definir nova senha
      tags: [Auth]
      security: [] # Rota pública
      parameters:
        - in: path
          name: token
          schema:
            type: string
          required: true
          description: Token recebido por email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  example: novaSenha123
      responses:
        200:
          description: Senha alterada com sucesso

  # ==========================
  # USUÁRIOS (USERS)
  # ==========================
  /api/users:
    get:
      summary: Listar todos os usuários (Apenas Admin)
      tags: [Users]
      responses:
        200:
          description: Lista de usuários
        403:
          description: Acesso negado (Requer Admin)
    
    post:
      summary: Criar um novo usuário (Apenas Admin)
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                  example: Novo Funcionario
                email:
                  type: string
                  example: novo@loja.com
                password:
                  type: string
                  example: senha123
                role:
                  type: string
                  enum: [admin, proprietario, atendente]
                  example: atendente
      responses:
        201:
          description: Usuário criado
        409:
          description: Email já existe

  /api/users/{id}:
    get:
      summary: Buscar usuário por ID
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: UUID do usuário
      responses:
        200:
          description: Dados do usuário
        404:
          description: Usuário não encontrado
    
    put:
      summary: Atualizar usuário (Apenas Admin)
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                role:
                  type: string
      responses:
        200:
          description: Atualizado com sucesso
    
    delete:
      summary: Deletar usuário (Apenas Admin)
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        200:
          description: Deletado com sucesso

  # ==========================
  # PERFIL (PROFILE)
  # ==========================
  /api/users/me:
    get:
      summary: Ver meu perfil (Usuário Logado)
      tags: [Profile]
      responses:
        200:
          description: Dados do perfil atual
    put:
      summary: Atualizar meu perfil (Nome apenas)
      tags: [Profile]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: Meu Nome Novo
      responses:
        200:
          description: Perfil atualizado